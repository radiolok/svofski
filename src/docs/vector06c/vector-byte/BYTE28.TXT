         Є”””””Џ Є”””””Џ Є”«© Є”Џ Є”””””Џ       Є”””””Џ Є”””””Џ
        ««««««”©«««««« ѓ«« ѓ «« ѓ««««««”©      «««««« ѓ«««««« ѓ
        «« ђ”””Џ«« ђ«« ѓ«« ѓ««« ѓ  «« ѓ   Є”””Џ««”©««Є©«« ђ«« ѓ
        «««««« ѓ«««««« ѓ«« «Є«« ѓ  «« ѓ  ««««”©   ««”© «««««« ѓ
        «« ђ«« ѓ«« ѓ«« ѓ«««Є©«« ѓ  «« ѓ         «« ђ””Џ«« ђ«« ѓ
        ««««««”©««”©««”©««”© ««”©  ««”©        ««««««”©««««««”©

     ЂЂЃЃ‚‚««««««««««««««««««««««««««««««««««««««««««««««««‚‚ЃЃЂЂ
     ЂЂЃЃ‚‚                                                ‚‚ЃЃЂЂ
     ЂЂЃЃ‚‚                  Центр "Байт"                  ‚‚ЃЃЂЂ
     ЂЂЃЃ‚‚           610031, г.Киров-31, а/я 2629         ‚‚ЃЃЂЂ
     ЂЂЃЃ‚‚            Луппов Григорий Борисович           ‚‚ЃЃЂЂ
     ЂЂЃЃ‚‚                                                ‚‚ЃЃЂЂ
     ЂЂЃЃ‚‚  Информационно-рекламный выпуск центра "Байт"  ‚‚ЃЃЂЂ
     ЂЂЃЃ‚‚                                                ‚‚ЃЃЂЂ
     ЂЂЃЃ‚‚««««««««««««««««««««««««««««««««««««««««««««««««‚‚ЃЃЂЂ

 Все больше и больше  пользователей ПК "Вектор-06Ц" оснащают свои ком-
пьютеры дисководами,  получая  при этом  огромный выигрыш  в  скорости
обработки информации (загрузка, копирование ...). Многим
™ќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќ‹
Љ      БИС КОНТРОЛЛЕРА КР1818ВГ93 ДЛЯ НАКОПИТЕЛЯ НА ГИБКОМ ДИСКЕ     Љ
ќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќќЊ
 Микросхема КР1818ВГ93 представляет собой однокристальное программиру-
емое устройство, предназначенное для управления выводом информации  из
ЭВМ на гибкие диски и вводом информации из НГМД в ЭВМ. БИС обеспечива-
ет  программирование номеров дорожки, сектора и стороны диска, а также
длины сектора, режимов поиска дорожки и установки МГ в исходное  поло-
жение, режимов чтения или записи информации, скорости перемещения МГ.
 Контроллер позволяет организовать автоматический контроль считываемой
и  записываемой информации  по  контрольному коду  (КК), записанному в
конце индексного и информационного массивов. Индексный массив включает
адресную метку, номер сектора,  длину  сектора, номер дорожки  и номер
стороны диска. Информационный массив  содержит метку и непосредственно
данные.
 В режиме записи м/с обеспечивает  выдачу сигналов предкомпенсации за-
писи в зависимости от кодов, представляющих информацию. Вывод информа-
ции из  ЭВМ выполняется по сигналу ЗАПРОС ДАННЫХ, формируемому  м/с, а
считывание определяется сигналами ГОТОВНОСТЬ и ИНДЕКСНЫЙ ИМПУЛЬС.
 Порты: 18Н - регистр данных
        19Н - регистр сектора
        1АН - регистр дорожки
        1ВН - регистр команд (OUT) / регистр состояния (IN)
        1СН - регистр управления.
 М/с обеспечивает выполнение 11 команд, разделенных на 4 группы: вспо-
могательные, записи и  чтения  информации, поиска и  чтения индексного
поля на ГМД, принудительного прерывания (табл.3)
 Команда  ВОССТАНОВЛЕНИЕ обеспечивает переход  МГ на  нулевую  дорожку
диска.  Если на  входе TR00 нет  подтверждения о выходе на 0-ю дорожку
после выдачи 256 импульсов, выполнение команды прекращается.
 Команда ПОИСК предполагает, что РгДор  содержит информацию о  текущем
номере дорожки, а РгД -  требуемой дорожки. Перемещение выполняется до
тех пор, пока содержимое РгДор не  сравняется с РгД. Поиск выполняется
при V=1.
 Команда ШАГ обеспечивает выдачу импульса  на  перемещение МГ  на один
шаг. Направление перемещения при этом не меняется.
 Команды ШАГ ВПЕРЕД и ШАГ НАЗАД обеспечивают перемещение МГ.
 Команды типа 2 обеспечивают считывание информации с диска и запись ее
на диск. Перед вводом этих команд необходимо в РгСект установить номер
требуемого  сектора.  Длина сектора задается  кодом  и  записывается в
индексной области при форматировании диска:
        Длина сектора           Число байт в секторе
             00 --------------------- 128
             01 --------------------- 256
             02 --------------------- 512
             03 --------------------- 1024
 По  командам типа  2 выполняется запись или чтение требуемого сектора
по  заданным  номерам  стороны,  сектора  и  дорожки диска с проверкой
индексной адресной метки (ИАМ) и (КК). Признаки этих команд соответст-
венно обозначаются (табл.3):
 m  - код, указывающий  на обращение  к  одному (0) или нескольким (1)
секторам.  При  m=1 после окончании работы с  первым сектором в РгСект
прибавляется 1 и начинается обработка следующего сектора. Эта операция
продолжается  до тех пор, пока не будет  обработан последний сектор на
данной дорожке;
 S - код, определяющий номер стороны диска (0 или 1);
 Е -  код, указывающий на выполнение задержки продолжительностью 15 мс
для  установки МГ в рабочее положение после  сигнала  HLD (при Е=0 за-
держки нет);
 С - код, указывающий на необходимость  проверки  номера стороны ГМД в
процессе идентификации индексной области (при С=0  номер стороны диска
не проверяется);
 а0 - код, используемый для выбора одного из двух возможных байт приз-
нака защиты  данных  для записи в области ИАМ (при  а0=1  записывается
байт F8, указывая, что  данные  могут стираться; при а0=0 записывается
байт FB, указывая, что область данных сохраняется).
 Контрольный код представлен в виде двух байт и вычисляется как цикли-
ческая сумма полинома А=Х^15+X^12+X^5+1;
 Команда ЧТЕНИЕ СЕКТОРА выполняется, когда идентифицированы номера до-
рожки, сектора и КК. Адресная метка данных должна быть установлена че-
рез 30 байт для одинарной и через 43 байта для двойной плотности запи-
си после КК  индексной  области. Если ИАМ  не найдена,  вырабатывается
признак МАССИВ ЧТЕНИЯ НЕ НАЙДЕН, который выдается в РгСост. После про-
хождения адресной метки  байты  данных вводятся в  РгСдв и  передаются
РгД. Каждый байт  сопровождается сигналом DRQ  ГОТОВНОСТЬ  ДАННЫХ. РгД
должен быть считан до приема  следующего байта. Если следующий байт не
считан, записывается следующий, а в РгСост записывается признак ПОТЕРЯ
ДАННЫХ.
 В конце считывания массива  данных КК должен совпадать с генерируемым
в микросхеме. Если  они  не  совпадают, выставляется  бит  ОШИБКА КК в
РгСост и прекращается выполнение команды даже при m=1.
 Команда  ЗАПИСЬ СЕКТОРА выполняется подобно  команде ЧТЕНИЕ СЕКТОРА в
части  анализа индексного массива, определения номера дорожки, стороны
диска, длины сектора и вычисления  КК. Сигнал DRQ генерируется, запра-
шивая первый байт данных, который  должен быть записан  на  ГМД. Затем
м/с вычисляет 11 байт при  одинарной (22 байта при  двойной) плотности
записи для обеспечения  пробела между индексной областью  и данными. С
момента прохождения 11  или 22 байт  (если  первый запрос  сигнала DRQ
обслужен и данные записаны в  РгД) выдается строб записи WSTB и 6 байт
нулей для  одинарной (12  байт  для двойной) плотности записываются на
диск. Это соответствует записи пробела, а затем записывается ИАМ. Байт
признака может быть или FB (без стирания данных) или F8 (со стиранием)
в соответствии с кодом а0.
 При записи данных на  ГМД каждый  байт  заносится в РгД, передается в
РгСдв  и  затем на диск. Сигнал  DRQ вырабатывается для  ЭВМ на каждый
последующий байт  данных. Если DRQ  не обслужен, вырабатывается сигнал
ПОТЕРЯ ДАННЫХ в разряде S1 РгСост, а на диске записывается байт нулей.
После записи данных записывается  КК  в виде  двух  байт, генерируемых
м/с,  затем  один  байт  FF, и  устанавливается низкий уровень сигнала
WSTB.
 Команды типа 3 предназначены для поиска информации на диске или запи-
си информации (форматирование диска). Структура кода содержит один бит
признака, определяющего необходимость включения  задержки  15 мс после
сигнала HLD, как и при выполнении команд типа 2.
 Команда ЧТЕНИЕ АДРЕСА выполняется  при установке МГ в рабочее положе-
ние (HLD=1).  В  бит состояния ЗАНЯТО записывается  1. Последовательно
считываются 6 байт индексной области, включая КК, и передаются на шину
данных в сопровождении сигнала DRQ. КК считывается и передается на ши-
ну данных, м/с проверяет его, если КК не  совпадает, выдается бит сос-
тояния ОШИБКА КК и  продолжается выполнение команды чтения. При выпол-
нении этой команды содержимое  РгДор пересылается в РгСект и запомина-
ется. По окончании выполнения команды генерируется сигнал INTRQ и очи-
щается бит состояния ЗАНЯТО.
 Команда ЧТЕНИЕ ДОРОЖКИ  обеспечивает чтение всей информации,  включая
индексный массив, контрольные коды, пробелы и массив данных, и переда-
чу ее в ЭВМ. В процессе чтения не  выдается строб чтения и не выполня-
ется проверка КК, что позволяет использовать данную команду в диагнос-
тических целях.
 Команда ЗАПИСЬ  ДОРОЖКИ предназначена  для разметки ГМД. Информация в
ЭВМ для этой процедуры должна содержать все пробелы и индексные метки.
Любая последовательность  данных, имеющаяся  в ЭВМ, записывается. Если
появляются байты F5...FE,  то они интерпретируются  как адресные метки
данных. КК  генерируется в момент  передачи  байтов  F8...FE из  РгД в
РгСдв в режиме ЧМ или при появлении байта F5 в режиме МЧМ. При появле-
нии  кода  F7  КК записывается  двумя  байтами.  Таким образом,  байты
F5...FE не должны записываться в местах  пробелов, области данных  или
индексных массивах.
 Команда типа 4 ПРИНУДИТЕЛЬНОЕ  ПРЕРЫВАНИЕ задается для завершения ка-
койлибо выполняемой команды. В отличие от других команд она может быть
записана в РгКом в любой момент времени.
 Однако исполнение команды может определяться состоянием младших битов
J0...J3. Если биты  J0...J3 находятся  в состоянии 0, прекращается вы-
полнение текущей команды  и сигнал  INTRQ  не вырабатывается. При J0=1
прерывание выполняется после перехода  сигнала CPRDY из низкого уровня
в  высокий. J1=1 определяет  прерывание по приходу индексного импульса
JP. J3=1 обеспечивает немедленное прерывание выполняемой команды. Пос-
ле выполнения этих условий вырабатывается сигнал INTRQ.
 Каждый служебный байт (табл.5) может быть размещен в индексной облас-
ти в соответствии  с  форматом  массива. Байт  FC определяет индексную
метку, которая ставится перед первым индексным массивом. FE - адресную
метку индексных данных, которая записывается в  начале индексного мас-
сива. F7 - код, который  указывает на необходимость  записи результата
вычисления первых двух байтов КК.
 В табл.6 и  7 приведены примерные форматы массивов данных, записывае-
мых на ГМД соответственно с одинарной  и удвоенной плотностью. При за-
писи отдельных служебных кодов с  ЧМ часть синхросигналов  опускается.
При  этом  наличие  сигналов S  определяется кодом CLK,  приведенным в
табл.6.

        Назначение битов регистра состояния.     Таблица 2.
Є””””””’””””””””””””””””””””””””””””””””””””””””””””””””””””””””””””Џ
ѓРазрядѓ                Выполняемая команда                         ѓ
ѓ      “”””””””””””’””””””””’”””””””””’”””””””””’”””””””””’”””””””””„
ѓ      ѓ Вспомога- ѓ Чтение ѓ Чтение  ѓ Чтение  ѓ Запись  ѓ Запись  ѓ
ѓ      ѓ тельная   ѓ адреса ѓ сектора ѓ дорожки ѓ сектора ѓ дорожки ѓ
“””””””•”””””””””””‘””””””””‘”””””””””‘”””””””””‘”””””””””‘”””””””””„
ѓ  7   ѓ   Разряд, указывающий на готовность НГМД (1-не готов)      ѓ
“””””””•”””””””””””’””””””””’”””””””””’”””””””””’”””””””””””””””””””„
ѓ  6   ѓ Защита    ѓ    0   ѓ    0    ѓ    0    ѓ Защита записи     ѓ
ѓ      ѓ записи    ѓ        ѓ         ѓ         ѓ                   ѓ
“””””””•”””””””””””•””””””””•”””””””””•”””””””””•”””””””””””””””””””„
ѓ  5   ѓ Загрузка  ѓ 0,Конецѓ Запись  ѓ    0    ѓ Ошибка записи     ѓ
ѓ      ѓ   МГ      ѓработы=1ѓсо стир. ѓ         ѓ                   ѓ
“””””””•”””””””””””•””””””””‘”””””””””•”””””””””•”””””””””’”””””””””„
ѓ  4   ѓ Ошибка    ѓ Массив не найден ѓ    0    ѓМассив неѓ  0      ѓ
ѓ      ѓ поиска    ѓ                  ѓ         ѓ найден  ѓ         ѓ
“””””””•”””””””””””‘””””””””””””””””””•”””””””””•”””””””””•”””””””””„
ѓ  3   ѓ Ошибка в контрольном коде    ѓ    0    ѓОшибка ККѓ  0      ѓ
“””””””•”””””””””””’””””””””””””””””””‘”””””””””‘”””””””””‘”””””””””„
ѓ  2   ѓ МГ в исх. ѓ            ПОТЕРЯ ДАННЫХ                       ѓ
ѓ      ѓ состоянии - TR00                                           ѓ
“””””””•”””””””””””’””””””””””””””””””””””””””””””””””””””””””””””””„
ѓ  1   ѓ Индексный ѓ            ЗАПРОС ДАННЫХ                       ѓ
ѓ      ѓ импульс   ѓ                                                ѓ
“””””””•”””””””””””‘””””””””””””””””””””””””””””””””””””””””””””””””„
ѓ  0   ѓ            ЗАНЯТО (идет выполнение команды)                ѓ
ђ””””””‘””””””””””””””””””””””””””””””””””””””””””””””””””””””””””””©

   Структура команд контроллера КР1818ВГ93. Табл.3.
Є””””””””””””””””””’”””””””””””””””””””””””””””””””””””Џ
ѓ Команда          ѓ       Структура кода, бит         ѓ
ѓ                  “”””””””””””””””””””””””””””””””””””„
ѓ                  ѓ   7   6   5   4   3   2   1   0   ѓ
“”””’””””””””””””””•”””””””””””””””””””””””””””””””””””„
ѓ т ѓВосстановлениеѓ   0   0   0   0   h   v   Ч1  Ч0  ѓ
ѓ и ѓПоиск         ѓ   0   0   0   1   h   v   Ч1  Ч0  ѓ
ѓ п ѓШаг           ѓ   0   0   1   И   h   v   Ч1  Ч0  ѓ
ѓ 1 ѓШаг вперед    ѓ   0   1   0   И   h   v   Ч1  Ч0  ѓ
ѓ   ѓШаг назад     ѓ   0   1   1   И   h   v   Ч1  Ч0  ѓ
“”””•””””””””””””””•”””””””””””””””””””””””””””””””””””„
ѓ т ѓЧтение сектораѓ   1   0   0   m   S   E   C   0   ѓ
ѓ и ѓЗапись сектораѓ   1   0   1   m   S   E   C   a0  ѓ
ѓ п ѓ              ѓ                                   ѓ
ѓ 2 ѓ              ѓ                                   ѓ
“”””•””””””””””””””•”””””””””””””””””””””””””””””””””””„
ѓ т ѓЧтение адреса ѓ   1   1   0   0   0   E   0   0   ѓ
ѓ и ѓЧтение дорожкиѓ   1   1   1   0   0   Е   0   0   ѓ
ѓ п ѓЗапись дорожкиѓ   1   1   1   1   0   Е   0   0   ѓ
ѓ 3 ѓ              ѓ                                   ѓ
“”””•””””””””””””””•”””””””””””””””””””””””””””””””””””„
ѓ т ѓПринудительноеѓ   1   1   0   1   J3  J2  J1  J0  ѓ
ѓ и ѓпрерывание    ѓ                                   ѓ
ѓ п ѓ              ѓ                                   ѓ
ѓ 4 ѓ              ѓ                                   ѓ
ђ”””‘””””””””””””””‘”””””””””””””””””””””””””””””””””””©
 Примечание: h - код установки МГ в рабочее положение (при h=0 МГ под-
нята, при h=1 МГ устанавлвается в рабочее положение); v - код, опреде-
ляющий необходимость проверки положения МГ (при  v=0 положение головки
не проверяется, при v=1 читается и проверяется номер дорожки, на кото-
рой находится МГ); Ч1,Ч0 - коды, определяющие скорость перемещения МГ;
И - код, определяющий состояние РгДор при перемещении МГ (при И=0 сос-
тояние РгДор не изменяется, при И=1 на каждом шаговом импульсе состоя-
ние РгДор меняется на 1 бит).

 Коды установки времени пере-   Форматы массивов данных в
казчикам. Если заказов будет мало, то  игра тиражироваться не будет, а
полученные  от заказчиков  деньги будут  перезачтены на  любое  другое
программное или аппаратное обеспечение, то есть никто ни чем не риску-
ет.  Ориентировочная стоимость игры, включая стоимость кассеты, почто-
вых расходов и других затрат - 10  тысяч рублей. Это - немного за  по-
добную игру "с продолжением", не имеющую пока аналогов на "Векторе".

 Несмотря  на то, что многие  авторы программ для  "Вектора" отошли от
создания новых программ, а программы,  которые все  же появляются,  не
самого высокого уровня, центр "Байт" пытается на условиях самофинанси-
рования  стимулировать  появление новых  разработок.  Схема достаточно
проста и эффективна. Автор пишет что-то новое, оригинальное,  красивое
и нужное, затем передает разработку  в центр.  Центр рассылает рекламу
клиентам, собирает заказы и деньги.  Далее возможно два варианта: наб-
ранных средств достаточно для  выплаты авторского гонорара и накладных
расходов (носитель + почта +  др.расходы) или не достаточно.  В первом
варианте автор программы  получает деньги, заказчики получают програм-
му. Во втором варианте программа не тиражируется, автор денег не полу-
чает, заказчики программу  не получают, но высланные деньги по  своему
желанию они могут направить на приобретение других аппаратных  и прог-
раммных новинок.
ЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇЇ

 